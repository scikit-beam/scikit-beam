
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Coding Guidelines &#8212; scikit-beam 0.0.18.post10+g384742b documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Emacs setup for following coding guidelines" href="codeguide_emacs.html" />
    <link rel="prev" title="Project organization" href="../overview.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="coding-guidelines">
<span id="code-guide"></span><h1>Coding Guidelines<a class="headerlink" href="#coding-guidelines" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This page is not fully adopted from astropy</p>
</div>
<p>This section describes requirements and guidelines that should be followed
both for the core package and for affiliated packages.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Affiliated packages will only be considered for integration as a
module in the core package once these guidelines have been
followed.</p>
</div>
<div class="section" id="interface-and-dependencies">
<h2>Interface and Dependencies<a class="headerlink" href="#interface-and-dependencies" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>All code must be compatible with Python 3.4 and later, as well as 2.7.
The use of <a class="reference external" href="http://pythonhosted.org/six/">six</a> for writing code that is portable between Python
2.7 and 3.x is required.</p></li>
</ul>
<blockquote>
<div><p>Code that uses <code class="docutils literal notranslate"><span class="pre">six</span></code> should use the following preamble:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
</pre></div>
</div>
<p>Additional information on writing code using <code class="docutils literal notranslate"><span class="pre">six</span></code> that is
compatible with both Python 2.x and 3.x is in the section
<a class="reference internal" href="#dev-portable"><span class="std std-ref">Writing portable code for Python 2 and 3</span></a>.</p>
</div></blockquote>
<ul>
<li><p>The new Python 3 formatting style should be used (i.e.
<code class="docutils literal notranslate"><span class="pre">&quot;{0:s}&quot;.format(&quot;spam&quot;)</span></code> instead of <code class="docutils literal notranslate"><span class="pre">&quot;%s&quot;</span> <span class="pre">%</span> <span class="pre">&quot;spam&quot;</span></code>).</p></li>
<li><p>The core package and affiliated packages should be importable with
no dependencies other than components already in the Scikit-beam core,
the <a class="reference external" href="http://docs.python.org/release/2.6/library/index.html">Python Standard Library</a>, and
<a class="reference external" href="http://numpy.scipy.org/">NumPy</a> <code class="docutils literal notranslate"><span class="pre">1.10</span></code> or later.</p></li>
<li><p>The package should be importable from the source tree at build time. This
means that, for example, if the package relies on C extensions that have
yet to be built, the Python code is still importable, even if none of its
functionality will work. One way to ensure this is to import the functions
in the C extensions only within the functions/methods that require them
(see next bullet point).</p></li>
<li><p>Additional dependencies - such as <a class="reference external" href="http://www.scipy.org/">SciPy</a>, <a class="reference external" href="http://matplotlib.org">Matplotlib</a>, or other
third-party packages - are allowed for sub-modules or in function
calls, but they must be noted in the package documentation and
should only affect the relevant component.  In functions and
methods, the optional dependency should use a normal <code class="docutils literal notranslate"><span class="pre">import</span></code>
statement, which will raise an <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> if the dependency is
not available.</p>
<p>At the module level, one can subclass a class from an optional dependency
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">opdep</span> <span class="k">import</span> <span class="n">Superclass</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warn</span><span class="p">(</span><span class="n">ScikitbeamWarning</span><span class="p">(</span><span class="s1">&#39;opdep is not present, so &lt;functionality below&gt; will not work.&#39;</span><span class="p">))</span>
    <span class="k">class</span> <span class="nc">SuperClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Whatever</span><span class="p">(</span><span class="n">Superclass</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>General utilities necessary for but not specific to the package or
sub-package should be placed in the <code class="docutils literal notranslate"><span class="pre">packagename.utils</span></code> module. These
utilities will be moved to the <code class="xref py py-mod docutils literal notranslate"><span class="pre">scikit-beam.utils</span></code> module when the
package is integrated into the core package. If a utility is already
present in <code class="xref py py-mod docutils literal notranslate"><span class="pre">scikit-beam.utils</span></code>, the package should always use that
utility instead of re-implementing it in <code class="docutils literal notranslate"><span class="pre">packagename.utils</span></code> module.</p></li>
</ul>
</div>
<div class="section" id="documentation-and-testing">
<h2>Documentation and Testing<a class="headerlink" href="#documentation-and-testing" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Docstrings must be present for all public classes/methods/functions, and
must follow the form outlined in the <a class="reference internal" href="docguide.html"><span class="doc">Writing Documentation</span></a> document.</p></li>
<li><p>Write usage examples in the docstrings of all classes and functions whenever
possible. These examples should be short and simple to reproduce–users
should be able to copy them verbatim and run them. These examples should,
whenever possible, be in the <a class="reference internal" href="testguide.html#doctests"><span class="std std-ref">doctest</span></a> format and will be
executed as part of the test suite.</p></li>
<li><p>Unit tests should be provided for as many public methods and functions as
possible, and should adhere to the standards set in the <a class="reference internal" href="testguide.html"><span class="doc">Testing Guidelines</span></a>
document.</p></li>
</ul>
</div>
<div class="section" id="data-and-configuration">
<h2>Data and Configuration<a class="headerlink" href="#data-and-configuration" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Packages can include data in a directory named <code class="docutils literal notranslate"><span class="pre">data</span></code> inside a subpackage
source directory as long as it is less than about 100 kb. These data should
always be accessed via the <code class="xref py py-func docutils literal notranslate"><span class="pre">scikit-beam.utils.data.get_pkg_data_fileobj()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">scikit-beam.utils.data.get_pkg_data_filename()</span></code> functions. If the data
exceeds this size, it should be hosted outside the source code repository,
either at a third-party location on the internet or the scikit-beam data server.
In either case, it should always be downloaded using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">scikit-beam.utils.data.get_pkg_data_fileobj()</span></code> or
<code class="xref py py-func docutils literal notranslate"><span class="pre">scikit-beam.utils.data.get_pkg_data_filename()</span></code> functions. If a specific
version of a data file is needed, the hash mechanism described in
<code class="xref py py-mod docutils literal notranslate"><span class="pre">scikit-beam.utils.data</span></code> should be used.</p></li>
<li><p>All persistent configuration should use the
<code class="xref py py-class docutils literal notranslate"><span class="pre">scikit-beam.config.ConfigurationItem</span></code> mechanism.  Such configuration items
should be placed at the top of the module or package that makes use of them,
and supply a description sufficient for users to understand what the setting
changes.</p></li>
</ul>
</div>
<div class="section" id="standard-output-warnings-and-errors">
<h2>Standard output, warnings, and errors<a class="headerlink" href="#standard-output-warnings-and-errors" title="Permalink to this headline">¶</a></h2>
<p>The built-in <code class="docutils literal notranslate"><span class="pre">print(...)</span></code> function should only be used for output that
is explicitly requested by the user, for example <code class="docutils literal notranslate"><span class="pre">print_header(...)</span></code>
or <code class="docutils literal notranslate"><span class="pre">list_catalogs(...)</span></code>. Any other standard output, warnings, and
errors should follow these rules:</p>
<ul class="simple">
<li><p>For errors/exceptions, one should always use <code class="docutils literal notranslate"><span class="pre">raise</span></code> with one of the
built-in exception classes, or a custom exception class. The
nondescript <code class="docutils literal notranslate"><span class="pre">Exception</span></code> class should be avoided as much as possible,
in favor of more specific exceptions (<code class="docutils literal notranslate"><span class="pre">IOError</span></code>, <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>,
etc.).</p></li>
<li><p>For warnings, one should always use <code class="docutils literal notranslate"><span class="pre">warnings.warn(message,</span>
<span class="pre">warning_class)</span></code>. These get redirected to <code class="docutils literal notranslate"><span class="pre">log.warn</span></code> by default,
but one can still use the standard warning-catching mechanism and
custom warning classes. The warning class should be either
<code class="xref py py-class docutils literal notranslate"><span class="pre">Scikit-beamUserWarning</span></code> or
inherit from it.</p></li>
<li><p>For informational and debugging messages, one should always use
<code class="docutils literal notranslate"><span class="pre">log.info(message)</span></code> and <code class="docutils literal notranslate"><span class="pre">log.debug(message)</span></code>.</p></li>
</ul>
<p>The logging system uses the built-in Python <a class="reference external" href="http://docs.python.org/library/logging.html">logging</a> module. The logger can
be imported using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scikit</span><span class="o">-</span><span class="n">beam</span> <span class="kn">import</span> <span class="nn">logger</span>
</pre></div>
</div>
</div>
<div class="section" id="coding-style-conventions">
<h2>Coding Style/Conventions<a class="headerlink" href="#coding-style-conventions" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>The code will follow the standard <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP8 Style Guide for Python Code</a>. In particular, this includes
using only 4 spaces for indentation, and never tabs.</p></li>
<li><p><em>Follow the existing coding style</em> within a subpackage and avoid making
changes that are purely stylistic.  In particular, there is variation in the
maximum line length for different subpackages (typically either 80 or 100
characters).  Please try to maintain the style when adding or modifying code.</p></li>
<li><p>One exception is to be made from the PEP8 style: new style relative imports
of the form <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.</span> <span class="pre">import</span> <span class="pre">modname</span></code> are allowed and required for Scikit-beam,
as opposed to absolute (as PEP8 suggests) or the simpler <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">modname</span></code>
syntax. This is primarily due to improved relative import support since PEP8
was developed, and to simplify the process of moving modules.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are multiple options for testing PEP8 compliance of code,
see <a class="reference internal" href="testguide.html"><span class="doc">Testing Guidelines</span></a> for more information.
See <a class="reference internal" href="codeguide_emacs.html"><span class="doc">Emacs setup for following coding guidelines</span></a> for some configuration options for Emacs
that helps in ensuring conformance to PEP8.</p>
</div>
</li>
<li><p>Scikit-beam source code should contain a comment at the beginning of the file (or
immediately after the <code class="docutils literal notranslate"><span class="pre">#!/usr/bin</span> <span class="pre">env</span> <span class="pre">python</span></code> command, if relevant)
pointing to the license for the Scikit-beam source code.  This line should say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Many files currently have the full 3-clause BSD, this may need
some discussion.</p>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code>, <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">matplotlib</span> <span class="pre">as</span> <span class="pre">mpl</span></code>, and <code class="docutils literal notranslate"><span class="pre">import</span>
<span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt</span></code> naming conventions should be used wherever
relevant. <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">packagename</span> <span class="pre">import</span> <span class="pre">*</span></code> should never be used, except as a
tool to flatten the namespace of a module. An example of the allowed usage
is given in <a class="reference internal" href="#import-star-example"><span class="std std-ref">Acceptable use of from module import *</span></a>.</p></li>
<li><p>Classes should either use direct variable access, or python’s property
mechanism for setting object instance variables. <code class="docutils literal notranslate"><span class="pre">get_value</span></code>/<code class="docutils literal notranslate"><span class="pre">set_value</span></code>
style methods should be used only when getting and setting the values
requires a computationally-expensive operation. <a class="reference internal" href="#prop-get-set-example"><span class="std std-ref">Properties vs. get_/set_</span></a>
below illustrates this guideline.</p></li>
<li><p>All new classes should be new-style classes inheriting from <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#object" title="(in Python v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a>
(in Python 3 this is a non-issue as all classes are new-style by default).
The one exception to this rule is older classes in third-party libraries such
the Python standard library or numpy.</p></li>
<li><p>Classes should use the builtin <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> function when making calls to
methods in their super-class(es) unless there are specific reasons not to.
<a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> should be used consistently in all subclasses since it does not
work otherwise.  <a class="reference internal" href="#super-vs-direct-example"><span class="std std-ref">super() vs. Direct Calling</span></a> illustrates why this is
important.</p></li>
<li><p>Multiple inheritance should be avoided in general without good reason.
Multiple inheritance is complicated to implement well, which is why many
object-oriented languages, like Java, do not allow it at all.  Python does
enable multiple inheritance through use of the
<a class="reference external" href="http://www.python.org/download/releases/2.3/mro/">C3 Linearization</a>
algorithm, which provides a consistent method resolution ordering.
Non-trivial multiple-inheritance schemes should not be attempted without
good justification, or without understanding how C3 is used to determine
method resolution order.  However, trivial multiple inheritance using
orthogonal base classes, known as the ‘mixin’ pattern, may be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> files for modules should not contain any significant
implementation code. <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> can contain docstrings and code for
organizing the module layout, however (e.g. <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">submodule</span> <span class="pre">import</span> <span class="pre">*</span></code>
in accord with the guideline above). If a module is small enough that
it fits in one file, it should simply be a single file, rather than a
directory with an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">try...except</span></code> blocks are used to catch exceptions, the <code class="docutils literal notranslate"><span class="pre">as</span></code>
syntax should always be used, because this is available in all supported
versions of python and is less ambiguous syntax (see
<a class="reference internal" href="#try-except-as-example"><span class="std std-ref">try…except block “as” syntax</span></a>).</p></li>
<li><p>Command-line scripts should follow the form outlined in the <a class="reference internal" href="scripts.html"><span class="doc">Writing Command-Line Scripts</span></a>
document.</p></li>
</ul>
</div>
<div class="section" id="unicode-guidelines">
<span id="handling-unicode"></span><h2>Unicode guidelines<a class="headerlink" href="#unicode-guidelines" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Top level utilities are not implemented yet.</p>
</div>
<p>For maximum compatibility, we need to assume that writing non-ascii
characters to the console or to files will not work.  However, for
those that have a correctly configured Unicode environment, we should
allow them to opt-in to take advantage of Unicode output when
appropriate.  Therefore, there is a global configuration option,
<code class="docutils literal notranslate"><span class="pre">scikit-beam.conf.unicode_output</span></code> to enable Unicode output of values, set
to <cite>False</cite> by default.</p>
<p>The following conventions should be used for classes that define the
standard string conversion methods (<code class="docutils literal notranslate"><span class="pre">__str__</span></code>, <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__unicode__</span></code>, <code class="docutils literal notranslate"><span class="pre">__bytes__</span></code>, and <code class="docutils literal notranslate"><span class="pre">__format__</span></code>).  In the bullets
below, the phrase “unicode instance” is used to refer to <code class="xref py py-class docutils literal notranslate"><span class="pre">unicode</span></code> on
Python 2 and <a class="reference external" href="https://docs.python.org/3.5/library/stdtypes.html#str" title="(in Python v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> on Python 3.  The phrase “bytes instance” is used
to refer to <a class="reference external" href="https://docs.python.org/3.5/library/stdtypes.html#str" title="(in Python v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> on Python 2 and <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#bytes" title="(in Python v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> on Python 3.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__repr__</span></code>: Return a “unicode instance” (for historical reasons,
could also be a “bytes instance” on Python 2, though not preferred)
containing only 7-bit characters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__str__</span></code> on Python 2 / <code class="docutils literal notranslate"><span class="pre">__bytes__</span></code> on Python 3: Return a “bytes
instance” containing only 7-bit characters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__unicode__</span></code> on Python 2 / <code class="docutils literal notranslate"><span class="pre">__str__</span></code> on Python 3: Return a “unicode
instance”.  If <code class="docutils literal notranslate"><span class="pre">scikit-beam.conf.unicode_output</span></code> is <cite>False</cite>, it must contain
only 7-bit characters.  If <code class="docutils literal notranslate"><span class="pre">scikit-beam.conf.unicode_output</span></code> is <cite>True</cite>, it
may contain non-ascii characters when applicable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__format__</span></code>: Return a “unicode instance”.  If
<code class="docutils literal notranslate"><span class="pre">scikit-beam.UNICODE_OUTPUT</span></code> is <cite>False</cite>, it must contain only 7-bit
characters.  If <code class="docutils literal notranslate"><span class="pre">scikit-beam.conf.unicode_output</span></code> is <cite>True</cite>, it may contain
non-ascii characters when applicable.</p></li>
</ul>
<p>For classes that are expected to roundtrip through strings (unicode or
bytes), the parser must accept either the output of <code class="docutils literal notranslate"><span class="pre">__str__</span></code> or
<code class="docutils literal notranslate"><span class="pre">__unicode__</span></code> unambiguously.  Additionally, <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> should
roundtrip when that makes sense.</p>
<p>This design generally follows Postel’s Law: “Be liberal in what you
accept, and conservative in what you send”.</p>
<p>The following example class shows a way to implement this (using <a class="reference external" href="http://pythonhosted.org/six/">six</a> for
Python 2 and 3 cross-version compatibility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">scikit</span><span class="o">-</span><span class="n">beam</span><span class="o">.</span><span class="n">extern</span> <span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">scikit</span><span class="o">-</span><span class="n">beam</span> <span class="kn">import</span> <span class="nn">conf</span>

<span class="k">class</span> <span class="nc">FloatList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">):</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;‖&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">init</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">init</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Return unicode object containing no non-ascii characters</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;FloatList [</span><span class="si">{0}</span><span class="s1">]&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
        <span class="fm">__str__</span> <span class="o">=</span> <span class="fm">__bytes__</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scikit</span><span class="o">-</span><span class="n">beam</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">unicode_output</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;‖&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__bytes__</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY3</span><span class="p">:</span>
        <span class="fm">__str__</span> <span class="o">=</span> <span class="n">__unicode__</span>
</pre></div>
</div>
<p>Additionally, there is a test helper,
<code class="docutils literal notranslate"><span class="pre">scikit-beam.test.helper.assert_follows_unicode_guidelines</span></code> to ensure that a
class follows the Unicode guidelines outlined above.  The following
example test will test that our example class above is compliant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_unicode_guidelines</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">scikit</span><span class="o">-</span><span class="n">beam</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">helper</span> <span class="kn">import</span> <span class="nn">assert_follows_unicode_guidelines</span>
    <span class="n">assert_follows_unicode_guidelines</span><span class="p">(</span><span class="n">FloatList</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;5|4|3|2&#39;</span><span class="p">),</span> <span class="n">roundtrip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="including-c-code">
<h2>Including C Code<a class="headerlink" href="#including-c-code" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>C extensions are only allowed when they provide a significant performance
enhancement over pure python, or a robust C library already exists to
provided the needed functionality. When C extensions are used, the Python
interface must meet the aforementioned python interface guidelines.</p></li>
<li><p>The use of <a class="reference external" href="http://cython.org/">Cython</a> is strongly recommended for C extensions, as per the
example in the template package. <a class="reference external" href="http://cython.org/">Cython</a> extensions should store <code class="docutils literal notranslate"><span class="pre">.pyx</span></code>
files in the source code repository, but they should be compiled to <code class="docutils literal notranslate"><span class="pre">.c</span></code>
files that are updated in the repository when important changes are made to
the <code class="docutils literal notranslate"><span class="pre">.pyx</span></code> file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We should discuss if we want to commit the <code class="docutils literal notranslate"><span class="pre">.c</span></code> or not.</p>
</div>
</li>
<li><p>If a C extension has a dependency on an external C library, the source code
for the library should be bundled with the Scikit-beam core, provided the
license for the C library is compatible with the Scikit-beam license.
Additionally, the package must be compatible with using a system-installed
library in place of the library included in Scikit-beam.</p></li>
<li><p>In cases where C extensions are needed but <a class="reference external" href="http://cython.org/">Cython</a> cannot be used, the <a class="reference external" href="http://www.python.org/dev/peps/pep-0007/">PEP 7
Style Guide for C Code</a> is
recommended.</p></li>
<li><p>C extensions (<a class="reference external" href="http://cython.org/">Cython</a> or otherwise) should provide the necessary information
for building the extension via the mechanisms described in
<a class="reference internal" href="ccython.html#building-c-or-cython-extensions"><span class="std std-ref">C or Cython Extensions</span></a>.</p></li>
</ul>
</div>
<div class="section" id="writing-portable-code-for-python-2-and-3">
<span id="dev-portable"></span><h2>Writing portable code for Python 2 and 3<a class="headerlink" href="#writing-portable-code-for-python-2-and-3" title="Permalink to this headline">¶</a></h2>
<p>As of scikit-beam 0.3, the <a class="reference external" href="http://pythonhosted.org/six/">six</a> library is included to allow supporting Python
2 and 3 from a single code base.  The use of the <a class="reference external" href="https://docs.python.org/3.5/library/2to3.html">2to3</a> tool has been
phased out in favor of using <code class="docutils literal notranslate"><span class="pre">six</span></code>.</p>
<p>This section is mainly about moving existing code that works with
<code class="docutils literal notranslate"><span class="pre">2to3</span></code> to using <code class="docutils literal notranslate"><span class="pre">six</span></code>.  It is not a complete guide to Python 2 and
3 compatibility.</p>
<p>Many more details and tools can be found at <a class="reference external" href="http://python-future.org/automatic_conversion.html">python-future</a></p>
<div class="section" id="welcome-to-the-future">
<h3>Welcome to the <code class="docutils literal notranslate"><span class="pre">__future__</span></code><a class="headerlink" href="#welcome-to-the-future" title="Permalink to this headline">¶</a></h3>
<p>The top of every <code class="docutils literal notranslate"><span class="pre">.py</span></code> file should include the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
</pre></div>
</div>
<p>This will make the Python 2 interpreter behave as close to Python 3 as
possible.</p>
<p>All files should also import <a class="reference external" href="http://pythonhosted.org/six/">six</a>, whether they are using it or not,
just to make moving code between modules easier, as <a class="reference external" href="http://pythonhosted.org/six/">six</a> gets used <em>a
lot</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">six</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-places-to-use-six">
<h3>Finding places to use six<a class="headerlink" href="#finding-places-to-use-six" title="Permalink to this headline">¶</a></h3>
<p>Unfortunately, the only way to be certain that code works on both
Python 2 and 3 is to make sure it is covered by unit tests.</p>
<p>The <a class="reference external" href="http://pythonhosted.org/six/">six</a> documentation serves as a
good reference for the sorts of things that need to be updated.</p>
</div>
<div class="section" id="not-so-fast-on-that-unicode-thing">
<h3>Not so fast on that Unicode thing<a class="headerlink" href="#not-so-fast-on-that-unicode-thing" title="Permalink to this headline">¶</a></h3>
<p>By importing <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> from <code class="docutils literal notranslate"><span class="pre">__future__</span></code>, many things
that were once byte strings on Python 2 will now by unicode strings.
This is mostly a good thing, as the behavior of the code will be more
consistent between Python 2 and 3.  However, certain third-party
libraries still assume certain values will be byte strings on
Python 2.</p>
<p>For example, when specifying Numpy structured dtypes, all strings must
be byte strings on Python 2 and unicode strings on Python 3.  The
easiest way to handle this is to force cast them using <code class="docutils literal notranslate"><span class="pre">str()</span></code>, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="s1">&#39;&gt;f8&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pytest.mark.skipif</span></code> also requires a “native” string, i.e.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skipif</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;CONDITIONAL&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="iteration">
<h3>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h3>
<p>The behavior of the methods for iterating over the items, values and
keys of a dictionary has changed in Python 3.  Additionally, other
built-in functions such as <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#zip" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">zip()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">range()</span></code> and <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#map" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a> have changed to
return iterators rather than temporary lists.</p>
<p>In many cases, the performance implications of iterating vs. creating
a temporary list won’t matter, so it’s tempting to use the form that
is simplest to read.  However, that results in code that behaves
differently on Python 2 and 3, leading to subtle bugs that may not be
detected by the regression tests.  Therefore, unless the loop in
question is provably simple and doesn’t call into other code, the
<a class="reference external" href="http://pythonhosted.org/six/">six</a> versions that ensure the same behavior on both Python 2 and 3
should be used.  The following table shows the mapping of equivalent
semantics between Python 2, 3 and six for <code class="docutils literal notranslate"><span class="pre">dict.items()</span></code>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Python 2</p></th>
<th class="head"><p>Python 3</p></th>
<th class="head"><p>six</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">d.items()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list(d.items())</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list(six.iteritems(d))</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">d.iteritems()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">d.items()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">six.iteritems(d)</span></code></p></td>
</tr>
</tbody>
</table>
<p>The above table holds true, analogously, for <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">keys</span></code>,
<code class="docutils literal notranslate"><span class="pre">zip</span></code>, <code class="docutils literal notranslate"><span class="pre">range</span></code> and <code class="docutils literal notranslate"><span class="pre">map</span></code>.</p>
<p>Note that for keys only, <code class="docutils literal notranslate"><span class="pre">list(d)</span></code> is an acceptable shortcut to
<code class="docutils literal notranslate"><span class="pre">list(six.iterkeys(d))</span></code>.</p>
</div>
<div class="section" id="issues-with-u-escapes">
<h3>Issues with <code class="docutils literal notranslate"><span class="pre">\u</span></code> escapes<a class="headerlink" href="#issues-with-u-escapes" title="Permalink to this headline">¶</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">unicode_literals</span></code> is used, all string
literals (not preceded with a <code class="docutils literal notranslate"><span class="pre">'b'</span></code>) will become unicode literals.</p>
<p>Normally, one would use “raw” string literals to encode strings that contain
a lot of slashes that we don’t want Python to interpret as special
characters.  Unfortunately, on Python 2, there is no way to represent
<code class="docutils literal notranslate"><span class="pre">'\u'</span></code> in a raw unicode string literal, since it will always be
interpreted as the start of a unicode character escape, such as
<code class="docutils literal notranslate"><span class="pre">'\u20af'</span></code>.  The only solution is to use a regular (non-raw) string
literal and repeat all slashes, e.g. <code class="docutils literal notranslate"><span class="pre">&quot;\\usepackage{foo}&quot;</span></code>.</p>
<p>The following shows the problem on Python 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">ur</span><span class="s1">&#39;\u&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) &#39;rawunicodeescape&#39; codec can&#39;t decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">ur</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span>
<span class="go">u&#39;\\\\u&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">u</span><span class="s1">&#39;\u&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) &#39;unicodeescape&#39; codec can&#39;t decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX escape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span>
<span class="go">u&#39;\\u&#39;</span>
</pre></div>
</div>
<p>This bug has been fixed in Python 3, however, we can’t take advantage
of that and still support Python 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">r</span><span class="s1">&#39;\u&#39;</span>
<span class="go">&#39;\\u&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span>
<span class="go">&#39;\\\\u&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;\u&#39;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
<span class="gr">SyntaxError</span>: <span class="n">(unicode error) &#39;unicodeescape&#39; codec can&#39;t decode bytes in</span>
<span class="go">position 0-1: truncated \uXXXX escape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">u&#39;</span>
<span class="go">&#39;\\u&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="compatibility-between-versions-of-numpy">
<span id="numpy-compatibility"></span><h2>Compatibility between versions of Numpy<a class="headerlink" href="#compatibility-between-versions-of-numpy" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This does not exist yet</p>
</div>
<p>In general, code should aim to be compatible with the lowest supported version
of <a class="reference external" href="http://numpy.scipy.org/">NumPy</a>.  Sometimes, however, it is inefficient to code repeatedly around
bugs in earlier versions. For those cases, code can be added to
<code class="docutils literal notranslate"><span class="pre">scikit-beam.utils.compat.numpy</span></code>; see the corresponding <a class="reference internal" href="#numpy-compatibility"><span class="std std-ref">instructions</span></a> for details.</p>
</div>
<div class="section" id="requirements-specific-to-affiliated-packages">
<h2>Requirements Specific to Affiliated Packages<a class="headerlink" href="#requirements-specific-to-affiliated-packages" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Affiliated packages implementing many classes/functions not relevant to
the affiliated package itself (for example leftover code from a previous
package) will not be accepted - the package should only include the
required functionality and relevant extensions.</p></li>
<li><p>Affiliated packages are required to follow the layout and documentation form
of the template package included in the core package source distribution.</p></li>
<li><p>Affiliated packages must be registered on the <a class="reference external" href="http://pypi.python.org/pypi">Python Package Index</a>, with proper metadata for downloading and
installing the source package.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">scikit-beam</span></code> root package name should not be used by affiliated
packages - it is reserved for use by the core package. Recommended naming
conventions for an affiliated package are either simply <code class="docutils literal notranslate"><span class="pre">packagename</span></code>
or <code class="docutils literal notranslate"><span class="pre">awscikit-beam.packagename</span></code> (“affiliated with Scikit-beam”).</p></li>
</ul>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>This section shows a few examples (not all of which are correct!) to
illustrate points from the guidelines. These will be moved into the template
project once it has been written.</p>
<div class="section" id="properties-vs-get-set">
<span id="prop-get-set-example"></span><h3>Properties vs. get_/set_<a class="headerlink" href="#properties-vs-get-set" title="Permalink to this headline">¶</a></h3>
<p>This example shows a sample class illustrating the guideline regarding the use
of properties as opposed to getter/setter methods.</p>
<p>Let’s assuming you’ve defined a <code class="docutils literal notranslate"><span class="pre">':class:`Star`'</span></code> class and create an instance
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Star</span><span class="p">(</span><span class="n">B</span><span class="o">=</span><span class="mf">5.48</span><span class="p">,</span> <span class="n">V</span><span class="o">=</span><span class="mf">4.83</span><span class="p">)</span>
</pre></div>
</div>
<p>You should always use attribute syntax like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
<span class="go">0.4</span>
</pre></div>
</div>
<p>Rather than like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>  <span class="c1">#Bad form!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>  <span class="c1">#Bad form!</span>
<span class="go">0.4</span>
</pre></div>
</div>
<p>Using python properties, attribute syntax can still do anything possible with
a get/set method. For lengthy or complex calculations, however, use a method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">compute_color</span><span class="p">(</span><span class="mi">5800</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mf">5e9</span><span class="p">))</span>
<span class="go">0.4</span>
</pre></div>
</div>
</div>
<div class="section" id="super-vs-direct-calling">
<span id="super-vs-direct-example"></span><h3>super() vs. Direct Calling<a class="headerlink" href="#super-vs-direct-calling" title="Permalink to this headline">¶</a></h3>
<p>This example shows why the use of <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> leads to a more consistent
method resolution order than manually calling methods of the super classes in a
multiple inheritance case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is dangerous and bug-prone!</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing A&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing B&#39;</span><span class="p">)</span>
        <span class="n">A</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing C&#39;</span><span class="p">)</span>
        <span class="n">A</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing D&#39;</span><span class="p">)</span>
        <span class="n">C</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">B</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>if you then do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">B</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
</pre></div>
</div>
<p>you will see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Doing</span> <span class="n">B</span>
<span class="n">Doing</span> <span class="n">A</span>
</pre></div>
</div>
<p>which is what you expect, and similarly for C. However, if you do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
</pre></div>
</div>
<p>you might expect to see the methods called in the order D, B, C, A but instead
you see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Doing</span> <span class="n">D</span>
<span class="n">Doing</span> <span class="n">C</span>
<span class="n">Doing</span> <span class="n">A</span>
<span class="n">Doing</span> <span class="n">B</span>
<span class="n">Doing</span> <span class="n">A</span>
</pre></div>
</div>
<p>because both <code class="docutils literal notranslate"><span class="pre">B.method()</span></code> and <code class="docutils literal notranslate"><span class="pre">C.method()</span></code> call <code class="docutils literal notranslate"><span class="pre">A.method()</span></code> unaware of
the fact that they’re being called as part of a chain in a hierarchy.  When
<code class="docutils literal notranslate"><span class="pre">C.method()</span></code> is called it is unaware that it’s being called from a subclass
that inherits from both <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code>, and that <code class="docutils literal notranslate"><span class="pre">B.method()</span></code> should be
called next.  By calling <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> the entire method resolution order for
<code class="docutils literal notranslate"><span class="pre">D</span></code> is precomputed, enabling each superclass to cooperatively determine which
class should be handed control in the next <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is safer</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing A&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing B&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing C&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Doing D&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
<span class="go">Doing D</span>
<span class="go">Doing C</span>
<span class="go">Doing B</span>
<span class="go">Doing A</span>
</pre></div>
</div>
<p>As you can see, each superclass’s method is entered only once.  For this to
work it is very important that each method in a class that calls its
superclass’s version of that method use <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a> instead of calling the
method directly.  In the most common case of single-inheritance, using
<code class="docutils literal notranslate"><span class="pre">super()</span></code> is functionally equivalent to calling the superclass’s method
directly.  But as soon as a class is used in a multiple-inheritance
hierarchy it must use <code class="docutils literal notranslate"><span class="pre">super()</span></code> in order to cooperate with other classes in
the hierarchy.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information on the the benefits of <a class="reference external" href="https://docs.python.org/3.5/library/functions.html#super" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">super()</span></code></a>, see
<a class="reference external" href="http://rhettinger.wordpress.com/2011/05/26/super-considered-super/">http://rhettinger.wordpress.com/2011/05/26/super-considered-super/</a></p>
</div>
</div>
<div class="section" id="acceptable-use-of-from-module-import">
<span id="import-star-example"></span><h3>Acceptable use of <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code><a class="headerlink" href="#acceptable-use-of-from-module-import" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> is discouraged in a module that contains
implementation code, as it impedes clarity and often imports unused variables.
It can, however, be used for a package that is laid out in the following
manner:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">packagename</span>
<span class="n">packagename</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">packagename</span><span class="o">/</span><span class="n">submodule1</span><span class="o">.</span><span class="n">py</span>
<span class="n">packagename</span><span class="o">/</span><span class="n">submodule2</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>In this case, <code class="docutils literal notranslate"><span class="pre">packagename/__init__.py</span></code> may be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A docstring describing the package goes here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">submodule1</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">submodule2</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>This allows functions or classes in the submodules to be used directly as
<code class="docutils literal notranslate"><span class="pre">packagename.foo</span></code> rather than <code class="docutils literal notranslate"><span class="pre">packagename.submodule1.foo</span></code>. If this is
used, it is strongly recommended that the submodules make use of the __all__
variable to specify which modules should be imported. Thus, submodule2.py
might read:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">array</span><span class="p">,</span><span class="n">linspace</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;AClass&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">bar</span><span class="p">):</span>
    <span class="c1">#the function would be defined here</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">AClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1">#the class is defined here</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>This ensures that <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">submodule</span> <span class="pre">import</span> <span class="pre">*</span></code> only imports <code class="docutils literal notranslate"><span class="pre">':func:`foo'</span></code>
and <code class="docutils literal notranslate"><span class="pre">':class:`AClass'</span></code>, but not <code class="docutils literal notranslate"><span class="pre">':class:`numpy.array'</span></code> or
<code class="docutils literal notranslate"><span class="pre">':func:`numpy.linspace'</span></code>.</p>
</div>
<div class="section" id="try-except-block-as-syntax">
<span id="try-except-as-example"></span><h3>try…except block “as” syntax<a class="headerlink" href="#try-except-block-as-syntax" title="Permalink to this headline">¶</a></h3>
<p>Catching of exceptions should always use this syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="o">...</span> <span class="n">some</span> <span class="n">code</span> <span class="n">that</span> <span class="n">might</span> <span class="n">produce</span> <span class="n">a</span> <span class="n">variety</span> <span class="n">of</span> <span class="n">exceptions</span> <span class="o">...</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;somemodule&#39;</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="s2">&quot;</span>
        <span class="c1">#for whatever reason, failed import of somemodule is ok</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Hit an input problem, which is ok,&#39;</span>
    <span class="n">msg2</span> <span class="o">=</span> <span class="s1">&#39;but we&#39;</span><span class="n">re</span> <span class="n">printing</span> <span class="n">it</span> <span class="n">here</span> <span class="n">just</span> <span class="n">so</span> <span class="n">you</span> <span class="n">know</span><span class="p">:</span><span class="s1">&#39;</span>
    <span class="nb">print</span> <span class="n">msg</span><span class="p">,</span> <span class="n">msg2</span><span class="p">,</span> <span class="n">e</span>
</pre></div>
</div>
<p>This avoids the old style syntax of <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">ImportError,</span> <span class="pre">e</span></code> or
<code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">(ValueError,TypeError),</span> <span class="pre">e</span></code>, which is dangerous because it’s easy to
instead accidentally do something like <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">ValueError,TypeError</span></code>, which
won’t catch <a class="reference external" href="https://docs.python.org/3.5/library/exceptions.html#TypeError" title="(in Python v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeError</span></code></a>.</p>
</div>
</div>
<div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<p>Further tips and hints relating to the coding guidelines are included below.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="codeguide_emacs.html">Emacs setup for following coding guidelines</a></li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">scikit-beam</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started with Scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html#updating-your-installation">Updating Your Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resource/api/index.html">Complete Reference (API)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workflow/get_devel_version.html">Try the development version</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/development_workflow.html">How to make a code contribution</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Project organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/development_workflow.html">How to make a code contribution</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Coding Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="docguide.html">Writing Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="testguide.html">Testing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Writing Command-Line Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building Scikit-beam and its Subpackages</a></li>
<li class="toctree-l1"><a class="reference internal" href="ccython.html">C or Cython Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Release Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/maintainer_workflow.html">Workflow for Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="affiliated-packages.html">How to create and maintain an Skbeam affiliated package</a></li>
<li class="toctree-l1"><a class="reference internal" href="vision.html">Vision for a Common Python Package for x-ray, electron and neutrons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resource/dev_guide/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_changes.html">API Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_versions.html">Supported versions of Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../warnings.html">Python warnings system</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew/index.html">Major Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Example gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction to scikit-beam</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../overview.html" title="previous chapter">Project organization</a></li>
      <li>Next: <a href="codeguide_emacs.html" title="next chapter">Emacs setup for following coding guidelines</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2015 Brookhaven National Lab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/development/codeguide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>